(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{297:function(e,t,s){"use strict";s.r(t);var a=s(13),r=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"serviceagreementregistry"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#serviceagreementregistry"}},[e._v("#")]),e._v(" ServiceAgreementRegistry")]),e._v(" "),t("h3",{attrs:{id:"overview"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),t("p",[e._v("This contract tracks all service Agreements for Indexers and Consumers.\nFor now, Consumer can accept the plan created by Indexer from Plan Manager to generate close service agreement.\nIndexer can also accept Purchase Offer created by Consumer from purchase offer market to generate close service agreement.\nAll generated service agreement need to register in this contract by calling establishServiceAgreement(). After this all SQT Toaken\nfrom agreements will be temporary hold in this contract, and approve reward distributor contract to take and distribute these Token.")]),e._v(" "),t("h3",{attrs:{id:"states"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#states"}},[e._v("#")]),e._v(" STATES")]),e._v(" "),t("h3",{attrs:{id:"settings"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#settings"}},[e._v("#")]),e._v(" settings")]),e._v(" "),t("p",[e._v("ISettings contract which stores SubQuery network contracts address")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("contract")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ISettings")]),e._v(" settings\n")])])]),t("h3",{attrs:{id:"nextserviceagreementid"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nextserviceagreementid"}},[e._v("#")]),e._v(" nextServiceAgreementId")]),e._v(" "),t("p",[e._v("the id for next ServiceAgreement")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint256")]),e._v(" nextServiceAgreementId\n")])])]),t("h3",{attrs:{id:"closedserviceagreements"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#closedserviceagreements"}},[e._v("#")]),e._v(" closedServiceAgreements")]),e._v(" "),t("p",[e._v("ServiceAgreementId => AgreementInfo")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("mapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint256")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClosedServiceAgreementInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" closedServiceAgreements\n")])])]),t("h3",{attrs:{id:"establisherwhitelist"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#establisherwhitelist"}},[e._v("#")]),e._v(" establisherWhitelist")]),e._v(" "),t("p",[e._v("address can establishServiceAgreement, for now only PurchaceOfferMarket and PlanManager addresses")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("mapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("address")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" establisherWhitelist\n")])])]),t("p",[e._v("Emitted when closed service agreement established")]),e._v(" "),t("h3",{attrs:{id:"closedagreementcreated"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#closedagreementcreated"}},[e._v("#")]),e._v(" ClosedAgreementCreated")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("event")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("ClosedAgreementCreated")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("address")]),e._v(" consumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("address")]),e._v(" indexer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bytes32")]),e._v(" deploymentId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint256")]),e._v(" serviceAgreementId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("p",[e._v("Initialize this contract. Load establisherWhitelist.")]),e._v(" "),t("h3",{attrs:{id:"initialize"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#initialize"}},[e._v("#")]),e._v(" initialize")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("initialize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("contract")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ISettings")]),e._v(" _settings"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" _whitelist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("external")]),e._v("\n")])])]),t("p",[e._v("See {IERC165-supportsInterface}.")]),e._v(" "),t("h3",{attrs:{id:"supportsinterface"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#supportsinterface"}},[e._v("#")]),e._v(" supportsInterface")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("supportsInterface")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bytes4")]),e._v(" interfaceId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("view")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("returns")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("h3",{attrs:{id:"setsettings"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setsettings"}},[e._v("#")]),e._v(" setSettings")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("setSettings")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("contract")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ISettings")]),e._v(" _settings"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("external")]),e._v("\n")])])]),t("h3",{attrs:{id:"addestablisher"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#addestablisher"}},[e._v("#")]),e._v(" addEstablisher")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("addEstablisher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("address")]),e._v(" establisher"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("external")]),e._v("\n")])])]),t("h3",{attrs:{id:"removeestablisher"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#removeestablisher"}},[e._v("#")]),e._v(" removeEstablisher")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("removeEstablisher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("address")]),e._v(" establisher"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("external")]),e._v("\n")])])]),t("h3",{attrs:{id:"aftertokentransfer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#aftertokentransfer"}},[e._v("#")]),e._v(" _afterTokenTransfer")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("_afterTokenTransfer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("address")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("address")]),e._v(" to"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint256")]),e._v(" tokenId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint256")]),e._v(" batchSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("internal")]),e._v("\n")])])]),t("h3",{attrs:{id:"createclosedserviceagreement"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#createclosedserviceagreement"}},[e._v("#")]),e._v(" createClosedServiceAgreement")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("createClosedServiceAgreement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClosedServiceAgreementInfo")]),e._v(" agreement"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bool")]),e._v(" checkThreshold"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("external")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("returns")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint256")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("p",[e._v("Establish the generated service agreement.\nFor now only establish the close service agreement generated from PlanManager and PurchsaseOfferMarket.\nThis function is called by PlanManager or PurchsaseOfferMarket when close service agreement generated,\nit temporary hold the SQT Token from these agreements, approve and nodify reward distributor contract to take and\ndistribute these Token.\nAll agreements register to this contract through this method.\nSQT need to be transfered before calling this function.\nWhen new agreement come we need to track the sumDailyReward of Indexer. In our design there is an upper limit\non the rewards indexer can earn every day, and the limit will increase with the increase of the total staked\namount of that indexer. This design can ensure our Customer to obtain high quality of service from Indexer，\nat the same time, it also encourages Indexer to provide better more stable services.")]),e._v(" "),t("h3",{attrs:{id:"establishserviceagreement"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#establishserviceagreement"}},[e._v("#")]),e._v(" _establishServiceAgreement")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("_establishServiceAgreement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint256")]),e._v(" agreementId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bool")]),e._v(" checkThreshold"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("internal")]),e._v("\n")])])]),t("p",[e._v("A function allow Consumer call to renew its unexpired closed service agreement.\nWe only allow the the agreement generated from PlanManager renewable which is created\nby Indexer and accepted by Consumer. We use the status planId in agreement to determine\nwhether the agreement is renewable, since only the agreement generated from PlanManager\ncome with the PlanId.\nIndexer can be prevente the agreement rennew by inactive the plan which bound to it.\nConsumer must renew befor the agreement expired.")]),e._v(" "),t("h3",{attrs:{id:"renewagreement"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#renewagreement"}},[e._v("#")]),e._v(" renewAgreement")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("renewAgreement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint256")]),e._v(" agreementId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("external")]),e._v("\n")])])]),t("h3",{attrs:{id:"closedserviceagreementexpired"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#closedserviceagreementexpired"}},[e._v("#")]),e._v(" closedServiceAgreementExpired")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("closedServiceAgreementExpired")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint256")]),e._v(" agreementId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("view")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("returns")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("h3",{attrs:{id:"getclosedserviceagreement"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#getclosedserviceagreement"}},[e._v("#")]),e._v(" getClosedServiceAgreement")]),e._v(" "),t("div",{staticClass:"language-solidity extra-class"},[t("pre",{pre:!0,attrs:{class:"language-solidity"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getClosedServiceAgreement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint256")]),e._v(" agreementId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("external")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("view")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("returns")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClosedServiceAgreementInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);