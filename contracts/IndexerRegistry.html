<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IndexerRegistry | SubQuery Network API</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/network-contracts/assets/css/0.styles.aa64b011.css" as="style"><link rel="preload" href="/network-contracts/assets/js/app.87a047ab.js" as="script"><link rel="preload" href="/network-contracts/assets/js/2.27a40bc7.js" as="script"><link rel="preload" href="/network-contracts/assets/js/16.502a2abc.js" as="script"><link rel="prefetch" href="/network-contracts/assets/js/10.dc2fb91c.js"><link rel="prefetch" href="/network-contracts/assets/js/11.089f3f28.js"><link rel="prefetch" href="/network-contracts/assets/js/12.1a2cee0f.js"><link rel="prefetch" href="/network-contracts/assets/js/13.65bbe297.js"><link rel="prefetch" href="/network-contracts/assets/js/14.ffe4e780.js"><link rel="prefetch" href="/network-contracts/assets/js/15.565d45f4.js"><link rel="prefetch" href="/network-contracts/assets/js/17.daa31d2a.js"><link rel="prefetch" href="/network-contracts/assets/js/18.2c831974.js"><link rel="prefetch" href="/network-contracts/assets/js/19.88a66e6d.js"><link rel="prefetch" href="/network-contracts/assets/js/20.19d92089.js"><link rel="prefetch" href="/network-contracts/assets/js/21.92efbd71.js"><link rel="prefetch" href="/network-contracts/assets/js/22.80800923.js"><link rel="prefetch" href="/network-contracts/assets/js/23.2ebcae78.js"><link rel="prefetch" href="/network-contracts/assets/js/24.80249bc3.js"><link rel="prefetch" href="/network-contracts/assets/js/25.3b934353.js"><link rel="prefetch" href="/network-contracts/assets/js/26.cfb06d9f.js"><link rel="prefetch" href="/network-contracts/assets/js/27.d0ed7b47.js"><link rel="prefetch" href="/network-contracts/assets/js/28.b37cf957.js"><link rel="prefetch" href="/network-contracts/assets/js/29.909e4505.js"><link rel="prefetch" href="/network-contracts/assets/js/3.dc631073.js"><link rel="prefetch" href="/network-contracts/assets/js/30.af6d54f3.js"><link rel="prefetch" href="/network-contracts/assets/js/31.75511620.js"><link rel="prefetch" href="/network-contracts/assets/js/32.1790e3e4.js"><link rel="prefetch" href="/network-contracts/assets/js/33.7d895206.js"><link rel="prefetch" href="/network-contracts/assets/js/34.98332cb4.js"><link rel="prefetch" href="/network-contracts/assets/js/35.092db0d4.js"><link rel="prefetch" href="/network-contracts/assets/js/36.16c2737f.js"><link rel="prefetch" href="/network-contracts/assets/js/37.eb7412c9.js"><link rel="prefetch" href="/network-contracts/assets/js/38.254dafb8.js"><link rel="prefetch" href="/network-contracts/assets/js/39.6803e9a0.js"><link rel="prefetch" href="/network-contracts/assets/js/4.344717be.js"><link rel="prefetch" href="/network-contracts/assets/js/40.1c61e7d4.js"><link rel="prefetch" href="/network-contracts/assets/js/41.21676a98.js"><link rel="prefetch" href="/network-contracts/assets/js/42.280c4e20.js"><link rel="prefetch" href="/network-contracts/assets/js/43.118aface.js"><link rel="prefetch" href="/network-contracts/assets/js/44.de03f1d9.js"><link rel="prefetch" href="/network-contracts/assets/js/45.7ca3dbb3.js"><link rel="prefetch" href="/network-contracts/assets/js/46.cafa4c3e.js"><link rel="prefetch" href="/network-contracts/assets/js/47.f3cebf03.js"><link rel="prefetch" href="/network-contracts/assets/js/48.6b3b9785.js"><link rel="prefetch" href="/network-contracts/assets/js/49.77625728.js"><link rel="prefetch" href="/network-contracts/assets/js/5.be4723dc.js"><link rel="prefetch" href="/network-contracts/assets/js/50.97cb6565.js"><link rel="prefetch" href="/network-contracts/assets/js/51.8c4ea14d.js"><link rel="prefetch" href="/network-contracts/assets/js/6.c89030cc.js"><link rel="prefetch" href="/network-contracts/assets/js/7.4680987c.js"><link rel="prefetch" href="/network-contracts/assets/js/8.0940ac83.js"><link rel="prefetch" href="/network-contracts/assets/js/9.8f7e1582.js">
    <link rel="stylesheet" href="/network-contracts/assets/css/0.styles.aa64b011.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/network-contracts/" class="home-link router-link-active"><!----> <span class="site-name">SubQuery Network API</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="indexerregistry"><a href="#indexerregistry" class="header-anchor">#</a> IndexerRegistry</h2> <h3 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h3> <p>The IndexerRegistry contract store and track all registered Indexers and related status for these Indexers.
It also provide the entry for Indexers to register, unregister, and config their metedata.</p> <h3 id="terminology"><a href="#terminology" class="header-anchor">#</a> Terminology</h3> <p>Indexer metadata -- The metadata of Indexer stored on IPFS include Indexer nickname, service endpoint...</p> <h3 id="detail"><a href="#detail" class="header-anchor">#</a> Detail</h3> <p>Each Indexer has two accounts:
Main Account:
The main account is stored in the indexerâ€™s own wallet.
The indexer can use the main account to make the following actions:
- staking/unstaking
- register/unregisterIndexer
- set/remove a controller account
- start an indexing for a query project with specific controller account</p> <p>Controller Account:
The controller account is set by the main account which can execute some
actions on the behalf of the main account.
These actions include:
- reporting / updating the status of the indexing service on chain</p> <p>Indexer must set a appropriate commission rate and stake enough SQT Token when registering.
Indexer need to make sure all the query projects with NOT INDEXING status before unregister.</p> <h3 id="commissionrate"><a href="#commissionrate" class="header-anchor">#</a> CommissionRate</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">struct</span> <span class="token class-name">CommissionRate</span> <span class="token punctuation">{</span>
  <span class="token builtin">uint256</span> era<span class="token punctuation">;</span>
  <span class="token builtin">uint256</span> valueAt<span class="token punctuation">;</span>
  <span class="token builtin">uint256</span> valueAfter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="states"><a href="#states" class="header-anchor">#</a> STATES</h3> <h3 id="settings"><a href="#settings" class="header-anchor">#</a> settings</h3> <p>ISettings contract which stores SubQuery network contracts address</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">contract</span> <span class="token class-name">ISettings</span> settings
</code></pre></div><h3 id="minimumstakingamount"><a href="#minimumstakingamount" class="header-anchor">#</a> minimumStakingAmount</h3> <p>The minimum stake amount for Indexer, set by owner</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token builtin">uint256</span> minimumStakingAmount
</code></pre></div><h3 id="metadata"><a href="#metadata" class="header-anchor">#</a> metadata</h3> <p>Indexer's metadata: indexer =&gt; metadata, if metadata = 0, no indexer</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token builtin">bytes32</span><span class="token punctuation">)</span> metadata
</code></pre></div><h3 id="commissionrates"><a href="#commissionrates" class="header-anchor">#</a> commissionRates</h3> <p>Delegation tax rate per indexer: indexer =&gt; commissionRate</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token keyword">struct</span> <span class="token class-name">IndexerRegistry</span><span class="token punctuation">.</span>CommissionRate<span class="token punctuation">)</span> commissionRates
</code></pre></div><h3 id="controllers"><a href="#controllers" class="header-anchor">#</a> controllers</h3> <p>indexer's controller: indexer =&gt; controller</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token builtin">address</span><span class="token punctuation">)</span> controllers
</code></pre></div><h3 id="events"><a href="#events" class="header-anchor">#</a> EVENTS</h3> <h3 id="registerindexer"><a href="#registerindexer" class="header-anchor">#</a> RegisterIndexer</h3> <p>Emitted when user register to an Indexer.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">event</span> <span class="token function">RegisterIndexer</span><span class="token punctuation">(</span><span class="token builtin">address</span> indexer<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amount<span class="token punctuation">,</span> <span class="token builtin">bytes32</span> metadata<span class="token punctuation">)</span>
</code></pre></div><h3 id="unregisterindexer"><a href="#unregisterindexer" class="header-anchor">#</a> UnregisterIndexer</h3> <p>Emitted when user unregister to an Indexer.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">event</span> <span class="token function">UnregisterIndexer</span><span class="token punctuation">(</span><span class="token builtin">address</span> indexer<span class="token punctuation">)</span>
</code></pre></div><h3 id="updatemetadata"><a href="#updatemetadata" class="header-anchor">#</a> UpdateMetadata</h3> <p>Emitted when Indexers update their Metadata.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">event</span> <span class="token function">UpdateMetadata</span><span class="token punctuation">(</span><span class="token builtin">address</span> indexer<span class="token punctuation">,</span> <span class="token builtin">bytes32</span> metadata<span class="token punctuation">)</span>
</code></pre></div><h3 id="setcontrolleraccount"><a href="#setcontrolleraccount" class="header-anchor">#</a> SetControllerAccount</h3> <p>Emitted when Indexer set the controller account.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">event</span> <span class="token function">SetControllerAccount</span><span class="token punctuation">(</span><span class="token builtin">address</span> indexer<span class="token punctuation">,</span> <span class="token builtin">address</span> controller<span class="token punctuation">)</span>
</code></pre></div><h3 id="removecontrolleraccount"><a href="#removecontrolleraccount" class="header-anchor">#</a> RemoveControllerAccount</h3> <p>Emitted when Indexer remove the controller account.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">event</span> <span class="token function">RemoveControllerAccount</span><span class="token punctuation">(</span><span class="token builtin">address</span> indexer<span class="token punctuation">,</span> <span class="token builtin">address</span> controller<span class="token punctuation">)</span>
</code></pre></div><h3 id="setcommissionrate"><a href="#setcommissionrate" class="header-anchor">#</a> SetCommissionRate</h3> <p>Emitted when Indexer set their commissionRate.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">event</span> <span class="token function">SetCommissionRate</span><span class="token punctuation">(</span><span class="token builtin">address</span> indexer<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amount<span class="token punctuation">)</span>
</code></pre></div><p>MODIFIER</p> <h3 id="onlyindexer"><a href="#onlyindexer" class="header-anchor">#</a> onlyIndexer</h3> <p>only indexer can call</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">modifier</span> <span class="token function">onlyIndexer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="functions"><a href="#functions" class="header-anchor">#</a> FUNCTIONS</h3> <h3 id="initialize"><a href="#initialize" class="header-anchor">#</a> initialize</h3> <p>Initialize the contract, setup the minimumStakingAmount.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token keyword">contract</span> <span class="token class-name">ISettings</span> _settings<span class="token punctuation">,</span> <span class="token builtin">uint256</span> _minimumStakingAmount<span class="token punctuation">)</span> <span class="token keyword">external</span>
</code></pre></div><table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>_settings</td> <td>contract ISettings</td> <td>ISettings contract</td></tr> <tr><td>_minimumStakingAmount</td> <td>uint256</td> <td></td></tr></tbody></table> <h3 id="setsettings"><a href="#setsettings" class="header-anchor">#</a> setSettings</h3> <p>Update setting state.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">setSettings</span><span class="token punctuation">(</span><span class="token keyword">contract</span> <span class="token class-name">ISettings</span> _settings<span class="token punctuation">)</span> <span class="token keyword">external</span>
</code></pre></div><table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>_settings</td> <td>contract ISettings</td> <td>ISettings contract</td></tr></tbody></table> <h3 id="setminimumstakingamount"><a href="#setminimumstakingamount" class="header-anchor">#</a> setminimumStakingAmount</h3> <p>set the Indexer minimum staking amount only by owner.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">setminimumStakingAmount</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> amount<span class="token punctuation">)</span> <span class="token keyword">external</span>
</code></pre></div><table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>amount</td> <td>uint256</td> <td>new minimumStakingAmount</td></tr></tbody></table> <h3 id="registerindexer-2"><a href="#registerindexer-2" class="header-anchor">#</a> registerIndexer</h3> <p>call to register to an Indexer, this function will interacte with staking contract to handle the Indexer first stake and commission rate setup.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">registerIndexer</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> amount<span class="token punctuation">,</span> <span class="token builtin">bytes32</span> _metadata<span class="token punctuation">,</span> <span class="token builtin">uint256</span> rate<span class="token punctuation">)</span> <span class="token keyword">external</span>
</code></pre></div><table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>amount</td> <td>uint256</td> <td>Indexer init staked amount(must over minimumStakingAmount)</td></tr> <tr><td>_metadata</td> <td>bytes32</td> <td>Indexer metadata</td></tr> <tr><td>rate</td> <td>uint256</td> <td>Indexer init commission rate</td></tr></tbody></table> <h3 id="unregisterindexer-2"><a href="#unregisterindexer-2" class="header-anchor">#</a> unregisterIndexer</h3> <p>Indexer call to unregister, need to check no running indexing projects on this Indexer from ProjectRegistry contract.
This function will call unstake for Indexer to make sure indexer unstaking all staked SQT Token after unregister.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">unregisterIndexer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span>
</code></pre></div><h3 id="updatemetadata-2"><a href="#updatemetadata-2" class="header-anchor">#</a> updateMetadata</h3> <p>Indexer call to update their Metadata.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">updateMetadata</span><span class="token punctuation">(</span><span class="token builtin">bytes32</span> _metadata<span class="token punctuation">)</span> <span class="token keyword">external</span>
</code></pre></div><table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>_metadata</td> <td>bytes32</td> <td>Indexer metadata to update</td></tr></tbody></table> <h3 id="setcontrolleraccount-2"><a href="#setcontrolleraccount-2" class="header-anchor">#</a> setControllerAccount</h3> <p>Indexers call to set the controller account, since indexer only allowed to set one controller account, we need to remove the previous controller account.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">setControllerAccount</span><span class="token punctuation">(</span><span class="token builtin">address</span> controller<span class="token punctuation">)</span> <span class="token keyword">external</span>
</code></pre></div><table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>controller</td> <td>address</td> <td>The address of controller account, indexer to set</td></tr></tbody></table> <h3 id="removecontrolleraccount-2"><a href="#removecontrolleraccount-2" class="header-anchor">#</a> removeControllerAccount</h3> <p>Indexers call to remove the controller account. need to remove both controllers and controllerToIndexer.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">removeControllerAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span>
</code></pre></div><h3 id="isindexer"><a href="#isindexer" class="header-anchor">#</a> isIndexer</h3> <p>Determine the address is a indexer account</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">isIndexer</span><span class="token punctuation">(</span><span class="token builtin">address</span> _address<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
</code></pre></div><table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>_address</td> <td>address</td> <td>The addree to determine is a indexer account</td></tr></tbody></table> <p>Return:  bool -&gt; Result of is the address is a indexer account</p> <h3 id="getcontroller"><a href="#getcontroller" class="header-anchor">#</a> getController</h3> <p>Get indexer's controller account</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">getController</span><span class="token punctuation">(</span><span class="token builtin">address</span> indexer<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">)</span>
</code></pre></div><table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>indexer</td> <td>address</td> <td>The indexer addree</td></tr></tbody></table> <p>Return:  address -&gt; Result of its controller</p> <p>Set initial commissionRate only called by indexerRegistry contract,
when indexer do registration. The commissionRate need to apply at once.</p> <h3 id="setinitialcommissionrate"><a href="#setinitialcommissionrate" class="header-anchor">#</a> setInitialCommissionRate</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">setInitialCommissionRate</span><span class="token punctuation">(</span><span class="token builtin">address</span> indexer<span class="token punctuation">,</span> <span class="token builtin">uint256</span> rate<span class="token punctuation">)</span> <span class="token keyword">private</span>
</code></pre></div><p>Set commissionRate only called by Indexer.
The commissionRate need to apply at two Eras after.</p> <h3 id="setcommissionrate-2"><a href="#setcommissionrate-2" class="header-anchor">#</a> setCommissionRate</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">setCommissionRate</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> rate<span class="token punctuation">)</span> <span class="token keyword">external</span>
</code></pre></div><h3 id="getcommissionrate"><a href="#getcommissionrate" class="header-anchor">#</a> getCommissionRate</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">getCommissionRate</span><span class="token punctuation">(</span><span class="token builtin">address</span> indexer<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/network-contracts/assets/js/app.87a047ab.js" defer></script><script src="/network-contracts/assets/js/2.27a40bc7.js" defer></script><script src="/network-contracts/assets/js/16.502a2abc.js" defer></script>
  </body>
</html>
